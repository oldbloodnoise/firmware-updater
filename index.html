<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" type="text/css" href="sakura.css" />
  <title>OBNE Firmware Updater</title>
  <script src="dfu.js"></script>
  <script src="dfuse.js"></script>
  <script src="FileSaver.js"></script>
  <script src="dfu-util.js"></script>
  <style>
    p.warning {
      color: red;
    }

    p.error {
      color: red;
      font-weight: bold;
    }

    label.radio {
      display: inline;
    }

    input:invalid {
      color: red;
    }
  </style>
</head>

<body>
  <div id="top" style="width:700px">
    <div style="width:300px; float:left;">
      <img width=300
        src="https://images.squarespace-cdn.com/content/6467b64a7c9d9e5cdae9a3ea/483fc396-6e35-4454-96eb-1ff564e9e73d/OBNE+-+Horizontal+OBNE+_W+Wordmark+Long_Underline.png?content-type=image%2Fpng">
    </div>
    <div style="width:400px; float:right; padding-left: .5em;">

      <h3>Firmware Updater</h3>

    </div>
  </div>
  <div style="clear: both;"></div>

  <div id="updatercontent">
    <p>
      <span id="status"></span>
    </p>
    <p>
      <button id="connect">Connect</button>
    </p>

    <div class="log" id="uploadLog"></div>

    <p>
      <button id="upload" disabled="true">Download BIN File from pedal</button>
    </p>

    <dialog id="interfaceDialog">
      Your device has multiple DFU interfaces. Select one from the list below:
      <form id="interfaceForm" method="dialog">
        <button id="selectInterface" type="submit">Select interface</button>
      </form>
    </dialog>
    <p>
    <div id="usbInfo" style="white-space: pre"></div>
    <div id="dfuInfo" style="white-space: pre"></div>
    </p>

    <p>
    <div id="fwselect">
      <label>Firmware:</label>

      <select id="firmwareFiles">
        <option value="DarkStar">Dark Star</option>
        <option value="BlackFountain">Black Fountain</option>
        <option value="Bathing">Bathing</option>
        <option value="Sunlight">Sunlight</option>
        <option value="Parting">Parting</option>
      </select>
    </div>
    </p>

    <p>
      <button id="download" disabled="true">Update</button>
    </p>
    <div class="log" id="downloadLog"></div>
  </div>

  <div id="instructions">
    <h5>Instructions for Use</h5>
    <details>
      <summary>Expand</summary>
      <ol>
        <li>Connect your Old Blood pedal to the computer via USB cable.</li>
        <li>Plug in 9V DC power to the pedal.</li>
        <li>Click “Connect” below.</li>
        <li>In the popup, select “DFU in FS Mode - Paired” then click “Connect”.</li>
        <li>Version information will be displayed. If an update is available, click “Update” to apply it.</li>
      </ol>
      <p>
        <b>Note:</b> updating firmware will NOT override user presets or global settings. If a full refresh is desired,
        run a
        factory reset after updating the firmware (see pedal instructions for the factory reset process).
      </p>
      <p>
        <b>If connecting an OBNE pedal for the first time on a Windows device</b>, you may need to install a driver
        using Zadig
        after following steps 1 and 2 (don’t worry, it’s quick and free).
      </p>
      <ol>
        <li>Download <a href="https://zadig.akeo.ie/">Zadig</a> and open it</li>
        <li>In Zadig, select Options->List All Devices</li>
        <li>In the drop down menu, select “DFU in FS Mode”</li>
        <li>Click “Install Driver” (this may be labeled “Update Driver”)</li>
        <li>Wait for installation to complete, then resume the process of the OBNE firmware update at step 3</li>
      </ol>
    </details>
  </div>


  <div id="troubleshooting">

    <h5>Troubleshooting</h5>
    <details>
      <summary><b>There is no option for DFU in FS Mode when I click connect</b></summary>
      Make sure you are plugging in USB before plugging in the pedal’s 9V DC power. Also make sure the USB cable is a
      data cable, not a charging-only cable.
    </details>
    <details>
      <summary><b>My pedal isn’t recognized</b></summary>
      Please reach out to us at contact@oldbloodnoise.com, and include the number given in the error message, name of
      pedal, and serial number (if available).
    </details>
    <details>
      <summary><b>The pedal isn’t lighting up after plugging in power</b></summary>
      This is normal behavior when USB has been plugged in first. The pedal will not boot up (leaving LEDs unlit)
      because it is awaiting connection to the computer.
    </details>
  </div>

  <div id="patchnotes">
    <h5>Patch notes</h5>
    <details>
      <summary>Dark Star</summary>
      <ul>
        <li>Added preset recall on startup</li>
        <li>Improved issues with MIDI message misalignment</li>
        <li>Improved issues with preset recall</li>
      </ul>
    </details>
    <details>
      <summary>Black Fountain</summary>
      <ul>
        <li>Fixed MIDI channel recall bug</li>
        <li>Improved issues with MIDI message misalignment</li>
        <li>Improved issues with preset recall</li>
      </ul>
    </details>
    <details>
      <summary>Sunlight</summary>
      <ul>
        <li>Fixed subdivision recall issue for subdivisions above 1x. (Note: with previously saved presets, subdivisions
          will
          now be recalled much faster. To fix this, simply recall the preset, change the subdivision without changing
          any
          other settings, then overwrite the preset.)</li>
        <li>Fixed issue with dynamic hold staying on while the pedal is turned off in trails mode</li>
      </ul>
    </details>
    <details>
      <summary>Bathing</summary>
      <ul>
        <li>Improved taper of Wet and Dry volume knobs (note: this may adjust volume of previously saved presets, and is
          an
          optional update)</li>
      </ul>
    </details>

  </div>

</body>

</html>